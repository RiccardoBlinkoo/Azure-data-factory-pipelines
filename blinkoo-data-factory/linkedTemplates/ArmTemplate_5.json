{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "blinkoo-data-factory"
		},
		"Kpis_trigger_properties_full_KPI_pipeline_parameters_triggerTime": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"Kpis_trigger_properties_full_KPI_pipeline_parameters_isTest": {
			"type": "string",
			"defaultValue": "False"
		},
		"Testing_Trigger_properties_TestTime_parameters_triggerTime": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"Testing_Trigger_properties_full_KPI_pipeline_parameters_triggerTime": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"Testing_Trigger_properties_full_KPI_pipeline_parameters_testNumber": {
			"type": "string",
			"defaultValue": "31"
		},
		"Testing_Trigger_properties_full_KPI_pipeline_parameters_isTest": {
			"type": "string",
			"defaultValue": "True"
		},
		"UserFeedList_Daily_properties_UserFeedList_parameters_OperationType": {
			"type": "string",
			"defaultValue": "daily"
		},
		"UserFeedList_Monday_properties_UserFeedList_parameters_OperationType": {
			"type": "string",
			"defaultValue": "weekly"
		},
		"DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_parameters_Tables": {
			"type": "array",
			"defaultValue": [
				"Feed",
				"FeedList",
				"PostStat",
				"UserInfo"
			]
		},
		"DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_parameters_end_time": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"DailyCosmosDB_properties_Daily_Bronze_SqlServer_parameters_Tables": {
			"type": "array",
			"defaultValue": [
				"place_tip",
				"categories",
				"geo_location",
				"places"
			]
		},
		"DailyCosmosDB_properties_Daily_Bronze_SqlServer_parameters_end_time": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"DailyCosmosDB_properties_Daily_Bronze_SqlServer_dev_parameters_Tables": {
			"type": "array",
			"defaultValue": [
				"place_tip",
				"categories",
				"geo_location",
				"places"
			]
		},
		"DailyCosmosDB_properties_Daily_Bronze_SqlServer_dev_parameters_end_time": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_dev_parameters_Tables": {
			"type": "array",
			"defaultValue": [
				"Feed",
				"FeedList",
				"PostStat",
				"UserInfo"
			]
		},
		"DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_dev_parameters_end_time": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"DailySilverLogAnalytics_properties_Silver_LogAnalytics_parameters_TableNames": {
			"type": "array",
			"defaultValue": [
				"AppDependencies",
				"AppEvents",
				"AppExceptions",
				"AppMetrics",
				"AppPageViews",
				"AppPerformanceCounters",
				"AppRequests",
				"AppSystemEvents",
				"AppTraces",
				"Usage"
			]
		},
		"DailySilverLogAnalytics_properties_Silver_LogAnalytics_parameters_start_time": {
			"type": "string",
			"defaultValue": "@trigger().startTime"
		},
		"WeeklyCosmosDB_properties_Weekly_Bronze_Update_CosmosDB_parameters_Tables": {
			"type": "array",
			"defaultValue": [
				"Categories"
			]
		},
		"WeeklyCosmosDB_properties_Weekly_Bronze_Update_CosmosDB_parameters_end_time": {
			"type": "string",
			"defaultValue": "2022-06-24 00:00:00"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/test_email_sending')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Web1",
						"type": "WebActivity",
						"dependsOn": [
							{
								"activity": "Copy data1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "https://extraction-email-delivering.azurewebsites.net:443/api/kpi-delivering/triggers/manual/invoke?api-version=2022-05-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=BzXu-Igb8pPfICCM1RUDexrs3mdNYF7MuIOB_SEe0yU",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {},
							"body": {
								"message": "This is a custom dynamic message from your pipeline with run ID @{pipeline().RunId}. It seems that the copy activity is working fine, check the data lake.",
								"dataFactoryName": "@{pipeline().DataFactory}",
								"pipelineName": "@{pipeline().Pipeline}",
								"receiver": "@{pipeline().parameters.receiver}"
							}
						}
					},
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureDatabricksDeltaLakeSource",
								"query": "SELECT * FROM blinkoo_gold.kpi_featureusage;",
								"exportSettings": {
									"type": "AzureDatabricksDeltaLakeExportCommand"
								}
							},
							"sink": {
								"type": "DelimitedTextSink",
								"storeSettings": {
									"type": "AzureBlobFSWriteSettings"
								},
								"formatSettings": {
									"type": "DelimitedTextWriteSettings",
									"quoteAllText": true,
									"fileExtension": ".csv"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "test_blinkoo_gold_delta_dataset",
								"type": "DatasetReference",
								"parameters": {}
							}
						],
						"outputs": [
							{
								"referenceName": "test_delimited_text_kpi_featureusage",
								"type": "DatasetReference",
								"parameters": {}
							}
						]
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"receiver": {
						"type": "string",
						"defaultValue": "riccardo.perelli@blinkoo.com"
					}
				},
				"folder": {
					"name": "Dev"
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Kpis_trigger')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "full_KPI_pipeline",
							"type": "PipelineReference"
						},
						"parameters": {
							"triggerTime": "[parameters('Kpis_trigger_properties_full_KPI_pipeline_parameters_triggerTime')]",
							"isTest": "[parameters('Kpis_trigger_properties_full_KPI_pipeline_parameters_isTest')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Week",
						"interval": 1,
						"startTime": "2022-10-25T06:59:59Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								6
							],
							"weekDays": [
								"Wednesday"
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Testing_Trigger')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "TestTime",
							"type": "PipelineReference"
						},
						"parameters": {
							"triggerTime": "[parameters('Testing_Trigger_properties_TestTime_parameters_triggerTime')]"
						}
					},
					{
						"pipelineReference": {
							"referenceName": "full_KPI_pipeline",
							"type": "PipelineReference"
						},
						"parameters": {
							"triggerTime": "[parameters('Testing_Trigger_properties_full_KPI_pipeline_parameters_triggerTime')]",
							"testNumber": "[parameters('Testing_Trigger_properties_full_KPI_pipeline_parameters_testNumber')]",
							"isTest": "[parameters('Testing_Trigger_properties_full_KPI_pipeline_parameters_isTest')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Minute",
						"interval": 1,
						"startTime": "2022-09-28T11:33:00Z",
						"timeZone": "UTC"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/UserFeedList_Daily')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "UserFeedList",
							"type": "PipelineReference"
						},
						"parameters": {
							"OperationType": "[parameters('UserFeedList_Daily_properties_UserFeedList_parameters_OperationType')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Week",
						"interval": 1,
						"startTime": "2023-02-10T16:52:00Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								6
							],
							"weekDays": [
								"Sunday",
								"Tuesday",
								"Wednesday",
								"Thursday",
								"Saturday",
								"Friday"
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/UserFeedList_Monday')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "UserFeedList",
							"type": "PipelineReference"
						},
						"parameters": {
							"OperationType": "[parameters('UserFeedList_Monday_properties_UserFeedList_parameters_OperationType')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Week",
						"interval": 1,
						"startTime": "2023-02-13T10:55:00Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								6
							],
							"weekDays": [
								"Monday"
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/UserPreferences_Monday')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "UserPreferences",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Week",
						"interval": 1,
						"startTime": "2023-02-10T16:38:00Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								5
							],
							"weekDays": [
								"Monday"
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DailyCosmosDB')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "Daily_Bronze_Update_CosmosDB",
							"type": "PipelineReference"
						},
						"parameters": {
							"Tables": "[parameters('DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_parameters_Tables')]",
							"end_time": "[parameters('DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_parameters_end_time')]"
						}
					},
					{
						"pipelineReference": {
							"referenceName": "Daily_Bronze_SqlServer",
							"type": "PipelineReference"
						},
						"parameters": {
							"Tables": "[parameters('DailyCosmosDB_properties_Daily_Bronze_SqlServer_parameters_Tables')]",
							"end_time": "[parameters('DailyCosmosDB_properties_Daily_Bronze_SqlServer_parameters_end_time')]"
						}
					},
					{
						"pipelineReference": {
							"referenceName": "Daily_Bronze_SqlServer_dev",
							"type": "PipelineReference"
						},
						"parameters": {
							"Tables": "[parameters('DailyCosmosDB_properties_Daily_Bronze_SqlServer_dev_parameters_Tables')]",
							"end_time": "[parameters('DailyCosmosDB_properties_Daily_Bronze_SqlServer_dev_parameters_end_time')]"
						}
					},
					{
						"pipelineReference": {
							"referenceName": "Daily_Bronze_Update_CosmosDB_dev",
							"type": "PipelineReference"
						},
						"parameters": {
							"Tables": "[parameters('DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_dev_parameters_Tables')]",
							"end_time": "[parameters('DailyCosmosDB_properties_Daily_Bronze_Update_CosmosDB_dev_parameters_end_time')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-06-02T03:00:00Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								3
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DailySilverLogAnalytics')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "Silver_LogAnalytics",
							"type": "PipelineReference"
						},
						"parameters": {
							"TableNames": "[parameters('DailySilverLogAnalytics_properties_Silver_LogAnalytics_parameters_TableNames')]",
							"start_time": "[parameters('DailySilverLogAnalytics_properties_Silver_LogAnalytics_parameters_start_time')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-07-13T03:00:00Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								3
							]
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/WeeklyCosmosDB')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "Weekly_Bronze_Update_CosmosDB",
							"type": "PipelineReference"
						},
						"parameters": {
							"Tables": "[parameters('WeeklyCosmosDB_properties_Weekly_Bronze_Update_CosmosDB_parameters_Tables')]",
							"end_time": "[parameters('WeeklyCosmosDB_properties_Weekly_Bronze_Update_CosmosDB_parameters_end_time')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Week",
						"interval": 1,
						"startTime": "2022-07-07T03:00:00Z",
						"timeZone": "UTC",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								3
							],
							"weekDays": [
								"Wednesday"
							]
						}
					}
				}
			},
			"dependsOn": []
		}
	]
}